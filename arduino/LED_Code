   //Code takes in serial input with 2 numbers. Duration and led# and displays red for white key and blue for black.
   // 9/12/18 ; Python communcation will be the next step. Converting MIDI to achieve 2 numbers, duration and led# (NOTE)
   

      #include <FastLED.h>
      #define LED_PIN     7
      #define NUM_LEDS    75
      #define BRIGHTNESS 15       // 0-64
      int i = 0;
      int LED = 0;    // Stores what LED is to be on
      long ledarray[NUM_LEDS] = {};   // if value in array is > 0, then LED for that index will be on ex ledarray[1] = 0 ;OFF       ledarray[2] = 1000  ;ON for 1 second
      int duration = 0;
      int input = 0;
      long blackKeys[] = {3,5,7,10,12,15,17,19,22,24,27,29,31,34,36,39,41,43,46,48,51,53,55,58,60,63,65,67,70,72,75};
   // long whiteKeys[] = {1,2,4,6,8,9,11,13,14,16,18,20,21,23,25,26,28,30,32,33,35,37,38,40,42,44,45,47,49,50,52,54,56,57,59,61,62,64,66,68,69,71,73,74,76}

      CRGB leds[NUM_LEDS];
      unsigned long ledStart[NUM_LEDS];

void setup() {

  
      Serial.setTimeout(15);  
      Serial.begin(9600);                         // Serial communication at 9600buad.
      Serial.flush();
      FastLED.addLeds<WS2812, LED_PIN, GRB>(leds, NUM_LEDS); 
      FastLED.setBrightness(BRIGHTNESS);
      FastLED.show();                              //Initializing all LEDs to off
      }                                              

  void checkleds()
  {
    unsigned long now = millis();
    for(i=0;i<NUM_LEDS;i++)
    {
      if(ledarray[i] > 0 && (now-ledStart[i])>=ledarray[i] )
      {
        ledarray[i] = 0;
        leds[i]=CRGB::Black;
      }
    }
  }

    
  void loop() {
  
   while (Serial.available() > 0)
   {
  
       input = Serial.parseInt();
     //  Serial.println(input);
  
  
      if( input > 76 )                 // Here the code will check if the input is greater than 76. If it is then that number will represent the duration of a note
       duration = input;               // if not then that number will be the LED number
      
      else if( input < 76 && input > 0 )
      {
        LED = input;

        for (i = 0; i < 31; i++)    // 31 is the length of the array of black keys!!!
          {                             
            if( LED == blackKeys[i] )     // If key is black key then color will be blue
            {
             leds[LED] = CRGB::Blue;
             break; 
            }

            else if(LED != blackKeys[i]){
              leds[LED] = CRGB::Red;
            }
          }
        
     //   leds[LED] = CRGB::Red;
        ledarray[input] = duration;
        Serial.print("Duration:" );
        Serial.println(duration);
        Serial.print("LED: ");
        Serial.println(input);
       
      
    }

    ledStart[LED] = millis();
    FastLED.show();
    
   }

   
   checkleds();
   FastLED.show();
  
  }
